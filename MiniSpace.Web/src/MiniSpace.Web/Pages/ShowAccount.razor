@page "/account"
@using MiniSpace.Web.Areas.Students
@using MiniSpace.Web.Components
@using MiniSpace.Web.DTO
@using Radzen
@inject IIdentityService IdentityService
@inject IStudentsService StudentsService
@inject NavigationManager NavigationManager

<h1>Data of your account:</h1>

@if (studentDto.Id != Guid.Empty)
{
    <RadzenStack Gap="1rem">
        
        <LabelWithStringTextBox Id="firstname" LabelText="Firstname:"
                                Value="@studentDto.FirstName" Disabled="true"/>

        <LabelWithStringTextBox Id="lastname" LabelText="Lastname:"
                                Value="@studentDto.LastName" Disabled="true"/>
        
        <LabelWithStringTextBox Id="email" LabelText="Email:"
                                Value="@studentDto.Email" Disabled="true"/>
        
        <LabelWithStringTextBox Id="description" LabelText="Description:"
                                Value="@studentDto.Description" Disabled="true"/>
        
        <LabelWithStringTextBox Id="state" LabelText="State:"
                                        Value="@studentDto.State" Disabled="true"/>
        
    </RadzenStack>
    
    <div class="container">

        <div class="row">
            <div class="col-sm-2">
                Number of friends:
            </div>
            <div class="col-sm">
                <b>@studentDto.NumberOfFriends</b>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-2">
                Date of birth:
            </div>
            <div class="col-sm">
                <b>@studentDto.DateOfBirth?.ToString("dd-MM-yyyy")</b>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-2">
                Email notifications:
            </div>
            <div class="col-sm">
                <b>@studentDto.EmailNotifications</b>
            </div>
        </div>
        
        <div class="row">
            <div class="col-sm-2">
                Created at:
            </div>
            <div class="col-sm">
                <b>@studentDto.CreatedAt.ToString("dd-MM-yyyy")</b>
            </div>
        </div>
    </div>
    
    <div>&nbsp;</div>
    
    @if (studentDto.State == "incomplete")
    {
        <RadzenRow AlignItems="AlignItems.Center">
            <RadzenColumn Size="12" SizeMD="12">
                <RadzenButton Size="ButtonSize.Large" Text="Complete registration"
                              Click="@(() => NavigationManager.NavigateTo("/signup/complete"))"/>
            </RadzenColumn>
        </RadzenRow>
    }
    else
    {
        <RadzenRow AlignItems="AlignItems.Center">
            <RadzenColumn Size="12" SizeMD="12">
                <RadzenButton Size="ButtonSize.Large" Text="Update account"
                              Click="@(() => NavigationManager.NavigateTo("/account/update"))"/>
            </RadzenColumn>
        </RadzenRow>
    }
}
else
{
    <p>Loading...</p>
}

@code {
    private StudentDto studentDto = new();
    
    protected override async Task OnInitializedAsync()
    {
        if (IdentityService.IsAuthenticated)
        {
            var userDto = await IdentityService.GetAccountAsync();
            studentDto = await StudentsService.GetStudentAsync(userDto.Id);
        }
    }
}
